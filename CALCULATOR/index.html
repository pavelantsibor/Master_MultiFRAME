<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Калькулятор MultiFRAME - расчёт и визуализация схем монтажа панелей на потолке">
    <meta name="theme-color" content="#01644f">
    <title>Калькулятор MultiFRAME</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <img src="logo.png" alt="Логотип" class="brand-logo" />
            <h1>Калькулятор MultiFRAME</h1>
            <p class="subtitle">Расчёт и визуализация схем монтажа на потолке</p>
        </header>

        <div class="main-content">
            <div class="input-panel">
                <div class="calc-group" id="paramsGroup">
                    <button class="btn btn-secondary" id="toggleParamsCalc" onclick="toggleParamsCalc()" style="margin-bottom: 16px;">
                        <svg class="toggle-indicator" width="10" height="10" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 0L6 6H0L3 0Z" fill="currentColor" opacity="0.5"/>
                        </svg>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink: 0;">
                            <rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/>
                            <rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor" opacity="0.8"/>
                            <rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor" opacity="0.8"/>
                            <rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/>
                        </svg>
                        Расчёт по параметрам
                    </button>
                    <div class="card" id="paramsCalcCard">
                    <h2 style="margin: 0;">Параметры потолка</h2>
                    <div class="form-group">
                        <label for="mainLength" title="Минимальное значение: 0.1 м, максимальное: 100 м">
                            Длина помещения (м):
                        </label>
                        <input type="number" id="mainLength" value="5.00" step="0.01" min="0.1" max="100" required>
                        <span class="error-message" id="mainLengthError"></span>
                    </div>
                    <div class="form-group">
                        <label for="mainWidth" title="Минимальное значение: 0.1 м, максимальное: 100 м">
                            Ширина помещения (м):
                        </label>
                        <input type="number" id="mainWidth" value="5.00" step="0.01" min="0.1" max="100" required>
                        <span class="error-message" id="mainWidthError"></span>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="hasLeg" checked style="margin: 0;">
                            <span>Г-образное помещение (с выступом)</span>
                        </label>
                    </div>
                    <div id="legFields" class="leg-fields" style="display: block;">
                        <div class="form-group">
                            <label for="legLength" title="Минимальное значение: 0.1 м, максимальное: 100 м">
                                Длина выступа (м):
                            </label>
                            <input type="number" id="legLength" value="1.50" step="0.01" min="0.1" max="100" required>
                            <span class="error-message" id="legLengthError"></span>
                        </div>
                        <div class="form-group">
                            <label for="legWidth" title="Минимальное значение: 0.1 м, максимальное: 100 м">
                                Ширина выступа (м):
                            </label>
                            <input type="number" id="legWidth" value="2.00" step="0.01" min="0.1" max="100" required>
                            <span class="error-message" id="legWidthError"></span>
                        </div>
                    </div>
                    </div>
                    <p class="calc-mode-hint hint-collapsed">
                        • Точный расчёт: параметры потолка и схема для прямоугольных и Г-образных комнат.
                    </p>
                </div>

                <div class="calc-group" id="areaGroup">
                    <button class="btn btn-secondary" id="toggleQuickCalc" onclick="toggleQuickCalc()" style="margin-bottom: 16px;">
                        <svg class="toggle-indicator" width="10" height="10" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 0L6 6H0L3 0Z" fill="currentColor" opacity="0.5"/>
                        </svg>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink: 0;">
                            <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Расчёт по площади
                    </button>
                    <div class="card" id="quickCalcCard">
                        <h2 style="display: flex; align-items: center; gap: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink: 0;">
                                <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="var(--heading-color)" stroke="var(--heading-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Расчёт по площади
                        </h2>
                        <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 12px;">
                            Приблизительная оценка по площади
                        </p>
                        <div class="form-group">
                            <label for="quickArea" title="Введите общую площадь помещения в квадратных метрах (от 0.1 до 10000 м²)">
                                Площадь помещения (м²):
                            </label>
                            <input type="number" id="quickArea" placeholder="25" step="0.1" min="0.1" max="10000">
                    </div>
                    </div>
                    <p class="calc-mode-hint hint-collapsed">
                        • Приблизительный расчёт: оценка по площади для сложных планировок.
                    </p>
                </div>

                <div class="card">
                    <h2>Параметры одной панели</h2>
                    <div class="form-group">
                        <label title="Размер панели учитывает эффективную площадь с учётом шип-паз соединения (0,735 × 0,535 м для расчёта)">
                            Размер:
                        </label>
                        <div class="static-field">0,75 × 0,55 м</div>
                    </div>
                    <div class="form-group">
                        <label title="Эффективная площадь покрытия одной панели с учётом шип-паз соединения равна 0,39 м²">
                            Площадь покрытия:
                        </label>
                        <div class="static-field">0,40 м²</div>
                    </div>
                    <div class="form-group">
                        <label title="Рекомендованная розничная цена за единицу и за квадратный метр">
                            РРЦ (рекомендованная розничная цена):
                        </label>
                        <div class="static-field">
                            <div>за единицу: 2 396 ₽</div>
                            <div>За м²: 5 990 ₽</div>
                        </div>
                    </div>
                </div>

                <button id="calculateBtn" class="btn btn-primary">
                    <span class="btn-icon" aria-hidden="true">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/>
                            <rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor" opacity="0.8"/>
                            <rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor" opacity="0.8"/>
                            <rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/>
                        </svg>
                    </span>
                    Рассчитать
                </button>
            </div>

            <div class="visualization-panel">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2 id="selectedSchemeTitle" style="margin: 0;">Схема монтажа</h2>
                        <div class="theme-toggle">
                            <label class="theme-switch" title="Переключить тему">
                                <input type="checkbox" id="themeSwitch" aria-label="Переключатель темы">
                                <span class="switch-track">
                                    <span class="icon-sun" aria-hidden="true"></span>
                                    <span class="icon-moon" aria-hidden="true"></span>
                                    <span class="switch-thumb"></span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <div class="canvas-container">
                        <div class="canvas-placeholder" id="schemePlaceholder">
                            <div class="placeholder-card">
                                Выполните расчёт, чтобы увидеть схему монтажа.
                            </div>
                        </div>
                        <div class="canvas-wrapper hidden" id="bestScheme">
                            <canvas id="canvas1"></canvas>
                            <div class="canvas-controls">
                                <button class="icon-btn" title="Увеличить" style="font-weight:700;" onclick="zoomCanvas('bestScheme', 1.2)">+</button>
                                <button class="icon-btn" title="Уменьшить" style="font-weight:700;" onclick="zoomCanvas('bestScheme', 0.8)">-</button>
                                <button class="icon-btn" title="Сбросить масштаб" onclick="resetCanvasView('bestScheme')">⟲</button>
                                <label class="canvas-checkbox">
                                    <input type="checkbox" id="showGrid" checked>
                                    Сетка
                                </label>
                                <label class="canvas-checkbox">
                                    <input type="checkbox" id="showNumbers" checked>
                                    Номера
                                </label>
                            </div>
                        </div>
                        <div class="canvas-wrapper hidden" id="areaSchemeWrapper">
                            <canvas id="areaCanvas"></canvas>
                            <div class="canvas-controls">
                                <button class="icon-btn" title="Увеличить" style="font-weight:700;" onclick="zoomCanvas('areaSchemeWrapper', 1.2)">+</button>
                                <button class="icon-btn" title="Уменьшить" style="font-weight:700;" onclick="zoomCanvas('areaSchemeWrapper', 0.8)">-</button>
                                <button class="icon-btn" title="Сбросить масштаб" onclick="resetCanvasView('areaSchemeWrapper')">⟲</button>
                                <label class="canvas-checkbox">
                                    <input type="checkbox" id="showGridArea" checked>
                                    Сетка
                                </label>
                                <label class="canvas-checkbox">
                                    <input type="checkbox" id="showNumbersArea" checked>
                                    Номера
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="stats-panel">
                        <div class="stat-card" data-stat="panels">
                            <div class="stat-label">Всего панелей (с запасом)</div>
                            <div class="stat-value" id="totalPanels">0 шт.</div>
                        </div>
                        <div class="stat-card" data-stat="coverage">
                            <div class="stat-label">Площадь покрытия</div>
                            <div class="stat-value" id="coverageArea">0 м²</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Общая стоимость панелей</div>
                            <div class="stat-value" id="totalCost">0 ₽</div>
                        </div>
                        <div class="stat-card-button">
                            <button class="btn-print" onclick="saveToPDF()">
                                <svg class="btn-print-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 9L12 14L17 9" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M7 14L12 19L17 14" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                СКАЧАТЬ РАСЧЁТ
                            </button>
                        </div>
                    </div>

                    <div class="card" style="margin-top:16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h2 style="margin: 0;">Результаты расчёта</h2>
                            <button class="btn-share-compact" onclick="generateShareLink()" title="Скопировать ссылку на расчёт">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 5.12548 15.0077 5.24917 15.0227 5.37061L8.08259 9.19346C7.54305 8.47607 6.72488 8 5.8 8C4.14315 8 2.8 9.34315 2.8 11C2.8 12.6569 4.14315 14 5.8 14C6.72488 14 7.54305 13.5239 8.08259 12.8065L15.0227 16.6294C15.0077 16.7508 15 16.8745 15 17C15 18.6569 16.3431 20 18 20C19.6569 20 21 18.6569 21 17C21 15.3431 19.6569 14 18 14C17.0751 14 16.2569 14.4761 15.7174 15.1935L8.77732 11.3706C8.79229 11.2492 8.8 11.1255 8.8 11C8.8 10.8745 8.79229 10.7508 8.77732 10.6294L15.7174 6.80654C16.2569 7.52393 17.0751 8 18 8Z" fill="currentColor"/>
                                </svg>
                                Поделиться
                            </button>
                        </div>
                        <div id="resultsText" style="white-space:pre-wrap; font-size:13px; color: var(--text-primary);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="calculator.js?v=2"></script>
    <script src="visualizer.js?v=2"></script>
    <script src="app.js?v=2"></script>
</body>
</html>

